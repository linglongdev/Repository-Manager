version: "1"

package:
  id: io.github.A-Photo-Tool-Libre
  name: A-Photo-Tool-Libre
  version: 1.0.6.1
  kind: app
  description: |
    a free image editor.

command:
  - /opt/apps/io.github.A-Photo-Tool-Libre/files/bin/aphototoollibre

base: org.deepin.foundation/23.0.0
runtime: org.deepin.Runtime/23.0.1

sources:
  - kind: git
    url: https://github.com/aphototool/A-Photo-Tool-Libre.git
    version: master
    commit: d80efa0ddef968df5824a4c37e15f08a424180e2

  - kind: git
    url: https://github.com/linuxdeepin/dde-qt-dbus-factory.git
    version: master

build: |
  # build dde-qt-dbus-factory
  cd /project/linglong/sources/dde-qt-dbus-factory.git
  qmake -makefile \
        PREFIX=${PREFIX} \
        LIB_INSTALL_DIR=${PREFIX}/lib/${TRIPLET} \
        INSTALL_ROOT=${PREFIX}

  make
  make install
  
  #build a-photo-tool-libre
  cd /project/linglong/sources/A-Photo-Tool-Libre.git
  cmake -Bbuild \
        -DCMAKE_INSTALL_PREFIX=${PREFIX} \
        -DCMAKE_INSTALL_LIBDIR=${PREFIX}/lib/${TRIPLET}
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_SAFETYTEST_ARG="CMAKE_SAFETYTEST_ARG_OFF" \

  cmake --build build
  cmake --build build --target install